\documentclass{beamer}
\usetheme{Madrid}
\usepackage{pgfplots}
\pgfplotsset{compat=1.15}
\usepackage{mathrsfs}
\usetikzlibrary{arrows}
\usepackage[utf8]{inputenc}
\usepackage{xcolor}
\usepackage{nicematrix}
\usepackage{tikz}
\usepackage{hyperref}
\usepackage{fancyvrb}
\usepackage{comment}
\usepackage{array}
\usepackage{pgfcore}
\usepackage{listings}
\usepackage{color}
\definecolor{munsell}{rgb}{0.0, 0.5, 0.69}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{minas}{RGB}{0.244, 0.172, 0.36}
\definecolor{PUJ}{RGB}{44, 86, 151}
\definecolor{PUJ2}{RGB}{43, 93, 156}
\definecolor{PUJ3}{RGB}{20, 52, 107}
\definecolor{cyandk}{rgb}{0.0, 0.72, 0.92}
\setbeamerfont{frametitle}{size=\LARGE ,series=\bfseries}
\setbeamercolor{frametitle}{fg=PUJ2, bg=white} %% title of the beamer
\setbeamercolor{titlelike}
{parent=structure,bg=PUJ2}
\setbeamercolor{title}{fg=white, bg=PUJ3} 
%\setbeamercolor{navigation symbols}{fg=white, bg=white}
\setbeamercolor*{palette primary}{use=structure,fg=black,bg=yellow}
\setbeamercolor*{palette secondary}{use=structure,fg=white,bg=PUJ3}
\setbeamercolor*{palette tertiary}{use=structure,fg=white,bg=PUJ3}

\setbeamercolor{block title}{bg=PUJ3,fg=white}


%% code information
\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  classoffset=1,
  morekeywords={True,False}, keywordstyle=\color{munsell}, 
  classoffset=0, 
  keywordstyle=\color{blue},  
  commentstyle=\color{dkgreen},
  stringstyle=\color{PUJ3},
  numberstyle=\tiny\color{gray},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4,
}

%% You can change default language in the middle of document with \lstset{language=Java}.


%% PUT or Remove the logo in a slide.


%% Information topic

\institute{Javeriana}
\date{2020}

\title[Pontificia Universidad Javeriana] %optional
{Supervivencia}
\subtitle{ Using python.}

\author[Iván Andrés Trujillo] 
{
Iván Andrés Trujilllo Abella}

\institute[] 
{
  Facultad de Ingenieria\\
  Pontificia Universidad Javeriana
  \and
  
\textbf{ trujilloiv@javeriana.edu.co }
}

\date[MINTA] % (optional)

\newif\ifplacelogo % create a new conditional
\placelogotrue % set it to true
%\logo{\ifplacelogo\color{red}\rule{.5cm}{.5cm}\fi}
\logo{\ifplacelogo \includegraphics[height= 2.0cm]{pujshield.eps}\fi}



\begin{document}





\frame{\titlepage}




\begin{frame}
Prediction or explication?
what matter?
\end{frame}

\begin{frame}{Research}{Quality research}

Weightman, W. M., Gibbs, N. M., Pavey, W. A., Larbalestier, R. I., Newman, M. A., Sheminant, M., & Matzelle, S. (2021). The Influence of Choice of Surgical Procedure on Long-Term Survival After Cardiac Surgery. Heart, Lung and Circulation.

This article was published in September i a British journal Q2, with 46 index.  

\end{frame}

\begin{frame}{ The Influence of Choice of Surgical Procedure on Long-Term Survival After Cardiac Surgery (2021)}
\textit{
"There is some interest in long-term survival after various cardiac surgical strategies, including off-pump versus on-pump coronary artery surgery (CAG), mitral valve (MV) repair versus replacement, and aortic valve (AV) bioprosthetic versus mechanical replacement."}
\end{frame}



\begin{frame}
\begin{figure}
  \centering
    \includegraphics[width=0.999\textwidth]{article-image.jpg}
  \caption{)}
  \label{Tabla 2 (del documento)}
\end{figure}

\end{frame}




\begin{frame}{Que es una función?}
En términos prácticos es una regla que asocia un valor de entrada con un valor de salida, por ejemplo los valores:

\begin{equation}
f(x) = 2x+1
\end{equation}


\end{frame}


\begin{frame}{Que es una variable aletoria?}
Determinadas sus condiciones su resultado no está predeterminado, expectativa de vida, el resultado al lazar una moneda.
\textbf{Distribución muestral de la media e inferencia, valor P.}
\end{frame}





\begin{frame}{introducción}
En el Análisis de supervivencia se pretende establecer una función de supervivencia:
 
$$S(t) = prob(T>t)$$

una formula que nos indique con que probabilidad ocurrirá un evento en un periodo determinado $t$. Aunque históricamente se asocia con la determinación del evento de defunción no es necesario que este sea el evento de interés, se extiende a todo evento que se presente en un lapso determinado de tiempo.

\end{frame}






\begin{frame}{Estudios de supervivencia}


\begin{itemize}

\item Tiempo transcurrido desde el diagnostico   de cáncer de estómago hasta el fallecimiento del individuo.

\item Tiempo de aparición de un tumor después de su resección. 


\item Tiempo transcurrido desde el inicio de tratamiento hasta la recuperación del movimiento de individuos afectados con Guillain- Barré.

\item el tiempo transcurrido hasta que un prematuro  obtenga su peso ideal.

\end{itemize}

\end{frame}


\begin{frame}{variables de estudio}
particularmente bajo ciertos supuestos(detallaremos más adelante) y en un análisis básico solo necesitamos la variable de ocurrencia del evento ( si se presenta o no ) y  el tiempo de observación, este ultimo depende del inicio de intervención o tratamiento hasta el cierre del control.


\end{frame}








\begin{frame}{Ejemplo de una base de datos pero y el ¿Estado 2?}



\begin{table}[]
\centering
\begin{tabular}{ccc}
caso & estado & tiempo en meses \\
1    & 1      & 24              \\
2    & 1      & 14              \\
3    & 0      & 60              \\
4    & 1      & 17              \\
5    & 2      & 38              \\
6    & 1      & 20              \\
7    & 0      & 48              \\
8    & 1      & 9               \\
9    & 1      & 1               \\
10   & 0      & 10             
\end{tabular}
\caption{Fuente: Rebasa (2005)}
\label{tab:my-table}
\end{table}

\end{frame}


\begin{frame}
Aunque para este tipo de estimación básica solamente se puede presentar el evento una vez,  es decir si un individuo  presenta el evento, termina su seguimiento;  no puede volver a presentar el evento. Aunque todos las observaciones se tomaron de esta forma existe un  concepto  que hay que tener en cuenta el de \textbf{censura}.  


\end{frame}

\begin{frame}{La censura}

 \textbf{la censura} se presenta por varias razones; entre ellas está por que al terminar el periodo de estudio el individuo no presentó el evento de interés o no se pudo establecer cual fue su resultado por otras razones que desconocemos, por lo tanto son observaciones censuradas:
 

\begin{itemize}

 \item  al finar  los 3 años de seguimiento por diagnostico de cáncer de estomago el individuo sigue vivo.

 \item  se censuró porque  presentó un evento que limitó su seguimiento.
 
 \item se trato de cáncer de mama pero  murió de un accidente de tránsito. 
 
 \item  el individuo cambió su lugar de residencia y perdimos su control.




\end{itemize}
 
el  tipo de censura que  nos interesa se denomina \textbf{ censura por la derecha} lo que implica que hay otros tipos de censura. 


\end{frame}


\begin{frame}{La censura aporta información}

Aunque no conozcamos el resultado final del individuo ( o el evento de interés no se presentó ) nos aporta información debido a que contribuye a la  población susceptible en el periodo antes de su censura. 


\end{frame}




\begin{frame}{Censura en la base de Rebasa(2005)}

Rebasa(2005) codificó la variable \textit{estado} de modo que $0$ fallecido por cáncer (objeto de estudio) ; $1$ vivo ; $2$ perdido.  

\begin{table}[]
\centering
\begin{tabular}{ccc}
caso & estado & tiempo en meses \\
1    & 1      & 24              \\
2    & 1      & 14              \\
3    & 0      & 60              \\
4    & 1      & 17              \\
5    & 2      & 38              \\
6    & 1      & 20              \\
7    & 0      & 48              \\
8    & 1      & 9               \\
9    & 1      & 1               \\
10   & 0      & 10             
\end{tabular}
\caption{Fuente: Rebasa (2005)}
\label{tab:my-table}
\end{table}

\end{frame}



\begin{frame}{¿Como analizamos esta información?}

Se debe tener en cuenta que algunas variables que implican tiempo, tienen una distribución particular; Pensemos en el tiempo de estancia hospitalaria ( Usualmente sesgada a la derecha) ¿por qué?

\begin{block}

ejemplo: Tiempo para que un individuo infecto por VIH desarrolle el Síndrome de Inmunodeficiencia Adquirida (SIDA)

\end{block}


\begin{block}

La censura limita el conocimiento preciso de cuando se presenta el evento de interés. 

\end{block}


\end{frame}


\begin{frame}{La función de supervivencia $S(t)$}

debe tener unas particularidades intuitivas:

\begin{itemize}
\item que al empezar el estudio la supervivencia global sea del 100\%


\item si seguimos al individuo por "la infinidad" el evento se presentará.


\end{itemize}



\end{frame}






\begin{frame}{ Kaplan - Meier }
Una forma tradicional de estimar $S(t)$ es por medio del estimador no paramétrico \textbf{Kaplan-Meier}. 
\end{frame}

\begin{frame}{Probabilidad}{Bag model}
Supongamos que en el momento del tiempo $t_0$ o en la bolsa $t_o$ hay  $n$ canicas (individuos), de los cuales $k$ son blancas(vivos) y $j$ son rojas (muertes)  y  $k + j = n $. La probabilidad de obtener en ese momento una bola roja (una muerte) no es mas que;

$$ P(roja)= \frac{j}{k+j} = \frac{j}{n}$$

\end{frame}

\begin{frame}
para el caso contrario la probabilidad de no obtener ninguna bola roja(defunción) es;

$$1 -P(roja)= 1 - \dfrac{j}{n}$$

Ahora supongamos que para el periodo siguiente esas $j$ bolas ya no están debido a que se han perdido o no se regresan a la bolsa y que  $i$ bolas  de las $k$ blancas se vuelven rojas con el lapso de tiempo por lo que hay $k-i$ blancas:

$$P(roja)= \dfrac{i}{k}$$


\end{frame} 

\begin{frame}{kaplan Meier}

En el análisis de los fenómenos que hemos analizado en cada momento del tiempo existen diferentes individuos en riesgo,así para el periodo $t_i$ hay $n_i$ individuos en riesgo de presentar el evento y en dicha muestra se presentan $d_i$ eventos por lo cual para ese periodo la probabilidad de ocurrencia es $\frac{d_{i}}{n_{i}} $, por el contrario de no ocurrencia es $1- \frac{d_{i}}{n_{i}}$. así el estimador de \textbf{K.M.} se define como


$$ \hat{S}(t_{i})=\prod_{{t\leq}t_{i}} (1-\frac{d_{i}}{n_{i}})$$

\end{frame} 









\begin{frame}{}
\begin{table}[]
\centering
\begin{tabular}{ccc}
id & meses & evento \\
1  & 3     & 1      \\
2  & 4     & 0      \\
3  & 5     & 1      \\
4  & 4     & 1      \\
5  & 3     & 0      \\
6  & 5     & 1      \\
7  & 6     & 0      \\
8  & 7     & 1     
\end{tabular}
\caption{Fuente: Elaboración propia }
\label{tab:my-table}
\end{table}

\end{frame}

\begin{frame}

\begin{table}[]
\centering
\resizebox{\textwidth}{!}{%
\begin{tabular}{cccccc}
tiempo & Sujetos riesgo & excluidos & P(a) & 1-P(a) & K.M(t) \\
3 & 8 & 2 & 1/8 & 7/8 & (7/8) \\
4 & 6 & 2 & 1/6 & 5/6 & (7/8) ( 5/6) \\
5 & 4 & 2 & 1/2 & 1 & (7/8) ( 5/6) (2/2) \\
6 & 2 & 1 & 0 & 1 & 1 \\
7 & 1 & 1 & 1 & 0 & 0
\end{tabular}%
}
\caption{Estimador de kaplan Meier}
\label{tab:my-table}
\end{table}

\end{frame}





\begin{frame}{La base organizada de maneara adecuada}
\begin{table}[]
\centering
\begin{tabular}{ccc}
caso & estado & tiempo en meses \\
1    & 0      & 24              \\
2    & 0      & 14              \\
3    & 1      & 60              \\
4    & 0      & 17              \\
5    & 0      & 38              \\
6    & 0      & 20              \\
7    & 1      & 48              \\
8    & 0      & 9               \\
9    & 0      & 1               \\
10   & 1      & 10             
\end{tabular}
\caption{Fuente: Rebasa (2005)}
\label{tab:my-table}
\end{table}

\end{frame}


\begin{frame}{ ¿ el artículo está mal?}

\begin{figure}
  \centering
    \includegraphics[width=0.999\textwidth]{tabla2rebasa.eps}
  \caption{Fuente: extraído de Rebasa(2005)}
  \label{Tabla 2 (del documento)}
\end{figure}

\end{frame}



\begin{frame}{Stata}
Utilicemos el paquete estadístico para calcular la función de supervivencia por medio del estimador \textbf{K.M.}
\end{frame}



\begin{frame}{Estimación en Stata}
Para llevar a cabo la estimación de $S(t)$ por el estimador no paramétrico  \textbf{K.M.} debemos organizar la variable de evento  de tal forma que los datos \textbf{censurados} se codifiquen con el valor cero(\textbf{0})  y los no censurados con la unidad(\textbf{1})
\end{frame}


\begin{frame}[fragile=singleslide]
Para  poder llevar el análisis, previamente a la obtención de $\hat{S}(t)$ debemos establecer o indicarle al programa cual es la variable de censura-No censura y el tiempo de ocurrencia.
\begin{verbatim}
stset vartime, failure(evento)

\end{verbatim}
 posteriormente la función de supervivencia $\hat{S}(t)$ estimada por \textbf{K.M.}  se obtiene por el comando:


\begin{verbatim}
sts list 

\end{verbatim}
\end{frame}


\begin{frame}{¿Que utilidad tiene esto?}
La comparación de dos curvas de supervivencia en dos poblaciones homogéneas con una diferencia de exposición nos permite establecer comparaciones entre dos curvas.

\begin{itemize}

\item Existe diferencias en la supervivencia entre un grupo A y un grupo B.

\item tienen mas supervivencia los individuos diagnosticado  cáncer A o B.

\item Es mas efectivo un tratamiento A o B para recuperar el movimiento.
\end{itemize}

\end{frame}

\begin{frame}[fragile=singleslide]{logrank test en stata}
Para probar que las curvas son iguales o que no existen diferencias significativas entre ellas partimos de la hipótesis nula $H_0$ de que ambas curvas son similares y no que tienen diferencias significativas entre ellas y utilizamos el comando:

\begin{verbatim}

sts test group, logrank

\end{verbatim}

\end{frame}


\begin{frame}{Presentación - artículos}

\includegraphics[scale=0.78]{curva.eps}



\end{frame}

\end{document}
